<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Inicio</title>

    <!-- Font Awesome -->
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
            href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
            rel="stylesheet"
    />
    <!-- MDB -->
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css"
            rel="stylesheet"
    />
    <!-- Ajax -->
    <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.16.0/themes/prism.min.css"
    />

    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/cloud.css" />
</head>
<body style="background-color: #cadce9">
<div id="clouds" style="padding: 0px;">
    <!--Form ciudad-->
    <div class="container mt-3">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="form-group autocomplete-container">
                    <p class="small muted" style="margin-bottom: 0">
                        Buscador por ciudad...
                    </p>
                    <form th:action="@{/ciudad}" method="post" th:object="${ciudad}">
                        <input
                                type="text"
                                class="form-control"
                                placeholder="Buscar... "
                                name="ciudad"
                                style="font-size: 2rem !important"
                        />
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--inicio de las cards-->
    <div class="container mt-3" th:if="${location != null}">
        <div class="row">
            <!-- reloj-->
            <div class="container py-5 h-100">
                <div class="row d-flex h-100 justify-content-center">
                    <div class="col-md-8 col-lg-5 col-xl-4">
                        <div class="card" style="border-radius: 10px">
                            <div
                                    class="bg-image ripple"
                                    data-mdb-ripple-color="light"
                                    style="
                      border-top-left-radius: 10px;
                      border-top-right-radius: 10px;
                    "
                            >
                                <img src="" class="w-100" id="imgDiaNoche" />
                                <div
                                        class="mask"
                                        style="background-color: rgba(0, 0, 0, 0.45)"
                                >
                                    <div class="d-flex justify-content-between p-4">
                                        <a href="#!" class="text-white"
                                        ><i class="fas fa-chevron-left fa-lg"></i
                                        ></a>
                                        <a href="#!" class="text-white"
                                        ><i class="fas fa-cog fa-lg"></i
                                        ></a>
                                    </div>
                                    <div class="text-center text-white">
                                        <p class="h3 mb-4" id="horario"></p>
                                        <p class="h5 mb-4" th:text="${location.region}"></p>
                                        <p class="display-2"><strong id="reloj"></strong></p>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body p-4 text-center">
                                <div class="d-flex justify-content-between mb-3">
                                    <p class="h5 fw-normal" id="diasemana"></p>
                                    <p
                                            class="h5 fw-normal"
                                            th:text="${current.temperature + ' °C'}"
                                    >
                                        <i class="fas fa-sun pe-2"></i>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div
                                class="card mb-4 gradient-custom"
                                style="border-radius: 25px"
                        >
                            <div class="card-body p-4">
                                <div id="demo1" class="carousel slide" data-ride="carousel">
                                    <!-- Carousel inner -->
                                    <div class="carousel-inner">
                                        <div class="carousel-item active">
                                            <div class="d-flex justify-content-between mb-4 pb-2">
                                                <div>
                                                    <h2 class="display-2">
                                                        <strong
                                                                th:text="${current.temperature + ' °C'}"
                                                        ></strong>
                                                    </h2>
                                                    <p
                                                            class="text-muted mb-0"
                                                            th:text="${request.query}"
                                                    ></p>
                                                </div>
                                                <div>
                                                    <img
                                                            src=""
                                                            width="150px"
                                                            id="imgDescripcionClima"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--                            aqui va lo otro-->
                        <div class="card mb-4" style="border-radius: 25px">
                            <div class="card mb-4" style="border-radius: 25px">
                                <div class="card-body p-4">
                                    <div
                                            id="demo2"
                                            class="carousel slide"
                                            data-ride="carousel"
                                    >
                                        <!-- Carousel inner -->
                                        <div class="carousel-inner">
                                            <div class="carousel-item active">
                                                <div
                                                        class="d-flex justify-content-around text-center mb-4 pb-3 pt-2"
                                                >
                                                    <div class="flex-column">
                                                        <p class="small"><strong id="temp0"></strong></p>
                                                        <i
                                                                class="fas fa-sun fa-2x mb-3"
                                                                style="color: #ddd"
                                                        ></i>
                                                        <p class="mb-0"><strong>12:00</strong></p>
                                                        <p
                                                                class="mb-0 text-muted"
                                                                style="font-size: 0.65rem"
                                                        >
                                                            PM
                                                        </p>
                                                    </div>
                                                    <div class="flex-column">
                                                        <p class="small"><strong id="temp1"></strong></p>
                                                        <i
                                                                class="fas fa-sun fa-2x mb-3"
                                                                style="color: #ddd"
                                                        ></i>
                                                        <p class="mb-0"><strong>1:00</strong></p>
                                                        <p
                                                                class="mb-0 text-muted"
                                                                style="font-size: 0.65rem"
                                                        >
                                                            PM
                                                        </p>
                                                    </div>
                                                    <div class="flex-column">
                                                        <p class="small"><strong id="temp2"></strong></p>
                                                        <i
                                                                class="fas fa-cloud fa-2x mb-3"
                                                                style="color: #ddd"
                                                        ></i>
                                                        <p class="mb-0"><strong>2:00</strong></p>
                                                        <p
                                                                class="mb-0 text-muted"
                                                                style="font-size: 0.65rem"
                                                        >
                                                            PM
                                                        </p>
                                                    </div>
                                                    <div class="flex-column">
                                                        <p class="small"><strong id="temp3"></strong></p>
                                                        <i
                                                                class="fas fa-cloud fa-2x mb-3"
                                                                style="color: #ddd"
                                                        ></i>
                                                        <p class="mb-0"><strong>3:00</strong></p>
                                                        <p
                                                                class="mb-0 text-muted"
                                                                style="font-size: 0.65rem"
                                                        >
                                                            PM
                                                        </p>
                                                    </div>
                                                    <div class="flex-column">
                                                        <p class="small"><strong id="temp4"></strong></p>
                                                        <i
                                                                class="fas fa-cloud-showers-heavy fa-2x mb-3"
                                                                style="color: #ddd"
                                                        ></i>
                                                        <p class="mb-0"><strong>4:00</strong></p>
                                                        <p
                                                                class="mb-0 text-muted"
                                                                style="font-size: 0.65rem"
                                                        >
                                                            PM
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div
                                class="card mb-4 gradient-custom"
                                style="height: 100%; border-radius: 25px"
                        >
                            <div class="card-body p-4">
                                <div class="text-end">
                                    <p class="small mb pb" style="font-size: 1rem">
                                        Descripion del clima
                                    </p>
                                    <p
                                            class="mt-2 mb pb-2"
                                            style="font-size: 2rem; line-height: 1"
                                    >
                                        <strong id="descripcionClima"></strong>
                                    </p>
                                    <!-- Velocidad del viento: *agregar km/h*-->
                                    <p class="small" style="margin-bottom: 0">
                                        Velocidad del viento
                                    </p>
                                    <p class="pb-1">
                                        <i class="fas fa-wind fa-fw" style="color: #868b94"></i>
                                        <strong
                                                th:text="${current.wind_speed + ' Km/h'}"
                                        ></strong>
                                    </p>
                                    <!-- Humedad relativa *agrega %*-->
                                    <p class="small" style="margin-bottom: 0">
                                        Humedad relativa
                                    </p>
                                    <p class="pb-1">
                                        <i class="fas fa-tint fa-fw" style="color: #868b94"></i>
                                        <strong th:text="${current.humidity + ' %'}"></strong>
                                    </p>
                                    <!-- Cobertura de nubes: % -->
                                    <p class="small" style="margin-bottom: 0">
                                        Cubertura de nubes
                                    </p>
                                    <p class="pb-1">
                                        <i
                                                class="fas fa-cloud fa-fw"
                                                style="color: #868b94"
                                        ></i>
                                        <strong th:text="${current.cloudcover + ' %'}"></strong>
                                    </p>
                                    <!-- Sensación térmica: -->
                                    <p class="small" style="margin-bottom: 0">
                                        Sensación térmica:
                                    </p>
                                    <p class="pb-1">
                                        <i
                                                class="fas fa-temperature-three-quarters fa-fw"
                                                style="color: #868b94"
                                        ></i>
                                        <strong th:text="${current.feelslike + ' °'}"
                                        >-7°</strong
                                        >
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Fin Reloj-->
            <!--temperatura-->

            <!--fin de temperatura-->
        </div>
    </div>
    <!--    fin reloj -->
    <div class="cloud x1"></div>
    <!-- Time for multiple clouds to dance around -->
    <div class="cloud x2"></div>
    <div class="cloud x3"></div>
    <div class="cloud x4"></div>
    <div class="cloud x5"></div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<!-- MDB -->
<script
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.umd.min.js"
></script>
<!-- jQuery UI -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<!--    popper-->
<script
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"
></script>
<!--    bootstrap-->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"
></script>
<script>
    document.addEventListener(
        "DOMContentLoaded",
        (e) => {
            $("#input-datalist").autocomplete();
        },
        false
    );
</script>

<script th:inline="javascript">

    var temperaturaActual = /*[[${current.temperature}]]*/;

    $("#temp0").text(temperaturaActual);
    $("#temp1").text(temperaturaActual - 3 + "°C");
    $("#temp2").text(temperaturaActual + 3 + "°C");
    $("#temp3").text(temperaturaActual + 2 + "°C");
    $("#temp4").text(temperaturaActual + 5 + "°C");


</script>

<script th:inline="javascript">

    var timezone = /*[[${location.timezone_id}]]*/;
    var descripcionClima = /*[[${current.weather_descriptions}]]*/;

    // Asegúrate de que descripcionClima sea un array y tenga al menos un elemento
    if (Array.isArray(descripcionClima) && descripcionClima.length > 0) {
        if (descripcionClima[0] == "Partly cloudy" || descripcionClima[0] == "Cloudy" || descripcionClima[0] == "Overcast") {
            document.getElementById("imgDescripcionClima").src = "img/solnube.png";
        } else if (descripcionClima[0] == "Clear") {
            document.getElementById("imgDescripcionClima").src = "img/soleado.png";
        } else if (descripcionClima[0] == "Rain" || descripcionClima[0] == "Thunderstorm") {
            document.getElementById("imgDescripcionClima").src = "img/lluvia.png";
        } else if (descripcionClima[0] == "Snow") {
            document.getElementById("imgDescripcionClima").src = "img/nieve.png";
        } else {
            document.getElementById("imgDescripcionClima").src = "img/soleado.png";
        }
    } else {
        // Manejar el caso en que el array esté vacío o no definido
        document.getElementById("imgDescripcionClima").src = "img/soleado.png";
    }


    function actualizarReloj() {
        const fecha = new Date();
        const opciones = { timeZone: timezone, hour12: false, hour: 'numeric', minute: 'numeric', second: 'numeric' };
        const horaFormateada = new Intl.DateTimeFormat('es-ES', opciones).format(fecha);

        const tiempo = horaFormateada;

        // Obtener el día de la semana
        const opcionesDiaSemana = { timeZone: timezone, weekday: 'long' };
        const diaSemana = new Intl.DateTimeFormat('es-ES', opcionesDiaSemana).format(fecha);

        //saber cuando es dia y noche
        const opcionesPeriodo = { timeZone: timezone, hour12: true, hour: 'numeric' };
        const periodo = new Intl.DateTimeFormat('es-ES', opcionesPeriodo).format(fecha);
        var horario = periodo.slice(-5).replace(/[\s.]/g, '');;// Obtener los últimos dos caracteres (AM o PM)

        if(horario == "am"){
            document.getElementById('horario').innerText = "Día";
            document.getElementById('imgDiaNoche').src = "img/dia.png"
        }else{
            document.getElementById('horario').innerText = "Noche";
            document.getElementById('imgDiaNoche').src = "https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-weather/draw2.webp"
        }

        document.getElementById('diasemana').innerText = diaSemana;
        document.getElementById('reloj').innerText = tiempo;
    }




    // Actualizar cada segundo
    setInterval(actualizarReloj, 1000);

    // Inicializar
    actualizarReloj();
</script>

<script th:inline="javascript">
    (async function() {
        var descripcionClima = /*[[${current.weather_descriptions}]]*/;

        // Reemplaza 'TU_CLAVE_DE_API' con tu propia clave de API de Google Translate
        const apiKey = 'AIzaSyDG2g1VHUR4HTigBPNe8O7MxRVzb0N2n0U';
        const url = `https://translation.googleapis.com/language/translate/v2?key=${apiKey}&source=en&target=es&q=${descripcionClima}`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            // Verifica si la traducción fue exitosa
            if (data && data.data && data.data.translations && data.data.translations.length > 0) {
                const traduccion = data.data.translations[0].translatedText;
                document.getElementById('descripcionClima').innerText = `${traduccion}`;
            } else {
                document.getElementById('descripcionClima').innerText = 'Soleado';
            }
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('descripcionClima').innerText = 'Soleado';
        }
    })();
</script>
</body>
</html>
